<div *ngIf="products">    
    <div class="card border-dark">
        <div class="card-header text-center">      
            <h4>Registrar Venta</h4>
        </div>
        <div class="card-body">     
            <div class="card-body">
                <!-- Client -->
                <form #formProduct="ngForm">
                    <div class="form-group d-inline-block float-right">
                        <input type="checkbox" class="mr-1" name="domicile" [(ngModel)]="client.domicile">
                        <label for="domicile">Domicilio</label>
                    </div>                                    
                    <div class="form-group d-inline-block mr-2">
                        <label for="name">Nombre<span class="text-danger">*</span></label>
                        <input type="text" class="form-control d-inline-block" name="name" placeholder="Nombre" #name="ngModel" [(ngModel)]="client.name" required>
                        <div class="span text-white bg-danger p-2 my-1" *ngIf="name.touched && !name.valid">El nombre es obligatorio.</div>
                    </div>
                    <div class="d-inline-block" *ngIf="client.domicile">
                        <div class="form-group d-inline-block">
                            <label for="address">Direccion</label>
                            <input type="text" class="form-control d-inline-block" name="address" placeholder="Direccion" [(ngModel)]="client.address" required>                    
                        </div>
                        <div class="form-group d-inline-block ml-2">
                            <label for="phoneNumber">Telefono</label>
                            <input type="text" class="form-control d-inline-block" name="phoneNumber" placeholder="Telefono" [(ngModel)]="client.phoneNumber" required>                    
                        </div>
                    </div>                
                </form>
            </div>
            <div class="row">
                <div class="col-5">
                    <div class="card-body">
                        <!-- Products Table -->                        
                        <div class="table-responsive">
                            <table datatable [dtOptions]="dtOptions" class="table table-striped table-bordered table-condensed" style="width: 100%">
                                <thead>
                                    <th>Nombre</th>
                                    <th>Acciones</th>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let product of products">
                                        <td>{{ product.name }}</td>
                                        <td class="text-center">
                                            <button class="btn btn-success text-center" (click)="addProduct(product)"><i class="fas fa-plus-circle"></i></button>                                
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-7">
                    <div class="card-body">
                        <!-- Shopping Cart -->
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-condensed" style="width: 100%">
                                <thead>
                                    <th>Nombre</th>
                                    <th>Precio</th>
                                    <th>Cantidad</th>
                                    <th>Acciones</th>
                                </thead>
                                <tbody *ngIf="shoppingCart">
                                    <tr *ngFor="let productInCart of shoppingCart; let i = index">
                                        <td class="align-middle">{{ productInCart.product.name }}</td>
                                        <td class="align-middle text-center">{{ productInCart.product.price | thousandsPipe }}</td>
                                        <td>
                                            <input type="number" class="form-control" [(ngModel)]="productInCart.amount" (keydown.enter)="actualizePrice()" (focusout)="actualizePrice()">
                                        </td>
                                        <td class="text-center">
                                            <button class="btn btn-danger text-center" (click)="deleteProduct(i)"><i class="far fa-minus-square"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="d-block">
                            <p class="h4 text-muted">Total: <span class="strong">{{ totalPrice | thousandsPipe }}</span></p>
                        </div>
                        <div>
                            <!-- Principal Actions -->                                
                            <button class="btn btn-info text-center" (click)="refreshPage()">Cancelar</button>
                            <button class="btn btn-success text-center ml-2" data-toggle="modal" data-target="#modal" (click)="finishOrder()" [disabled]="client.name.length <= 0 || shoppingCart.length == 0 ? true : null"><i class="far fa-file"></i> Terminar Pedido</button>
                        </div>                
                    </div>
                </div>
            </div>                        
            <div>
                <!-- Modal -->
                <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Pedido Finalizado</h5>
                            </div>
                            <div class="modal-body">
                                <!-- Ticket -->
                                <div class="m-2" id="ticket" #ticket>
                                    <img src="../../../assets/logo.png" class="rounded" style="width: 54px; height: 54px;" alt="Logo">
                                    <h2 class="d-inline-block text-center">Del Perrero</h2>
                                    <p class="text-center text-justify border border-dark p-2 my-2">Encuentranos en fulldomi o escribenos al 3135444317 para hacer tus domicilios</p>                                    
                                    <p>                                        
                                        <strong>Nombre:</strong> {{ client.name }} |
                                        <span *ngIf="client.domicile">
                                            Direccion: {{ client.address }} |
                                            Telefono: {{ client.phoneNumber }}
                                        </span>
                                        <span *ngIf="!client.domicile">
                                            Pedido Local
                                        </span>
                                    </p>                                                                                    
                                    <table class="table table-sm my-2">
                                        <thead>
                                            <th>Producto</th>
                                            <th>Cantidad</th>
                                            <th>Precio</th>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let productInCart of shoppingCart">
                                                <td>{{ productInCart.product.name }}</td>
                                                <td>{{ productInCart.amount | thousandsPipe }}</td>
                                                <td>{{ productInCart.product.price | thousandsPipe }}</td>
                                            </tr>
                                        </tbody>
                                        <tfoot class="font-weight-bold">                                            
                                            <td>Total</td>
                                            <td></td>
                                            <td>{{ totalPrice | thousandsPipe }}</td>
                                        </tfoot>
                                    </table>                                                                        
                                </div>
                            </div>
                            <div class="modal-footer">                                
                                <button class="btn btn-info text-center" (click)="refreshPage()" data-dismiss="modal">Salir</button>                                                                                        
                                <button class="btn btn-info text-center" (click)="printPDF()"><i class="fas fa-print"></i> Imprimir</button>                                                                                           
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="!products">
    <div class="d-flex justify-content-center">
        <div class="spinner-border text-primary" role="status" style="height: 5rem; width: 5rem;">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>
