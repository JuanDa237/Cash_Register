<div *ngIf="products">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Registradora</h1>
    </div>
    <div class="row">        
        <div class="col-md-5 mb-md-0 mb-2">
            <!-- Client Information -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h4">Cliente</h1>
            </div>
            <div class="input-group mb-2">
                <div class="input-group-prepend">
                    <span class="input-group-text font-weight-bold">Nombre</span>
                </div>
                <input type="text" class="form-control text-dark" [attr.value]="client.name" readonly>
            </div>
            <div class="input-group mb-2">
                <div class="input-group-prepend">
                    <span class="input-group-text font-weight-bold">Direccion</span>
                </div>
                <input type="text" class="form-control text-dark" [attr.value]="client.address" readonly>
            </div>
            <div class="input-group mb-2">
                <div class="input-group-prepend">
                    <span class="input-group-text font-weight-bold">Telefono</span>
                </div>
                <input type="text" class="form-control text-dark" [attr.value]="client.phoneNumber" readonly>
            </div>
            <div>
                <button class="btn btn-info btn-block" routerLink="/clients"><i class="fas fa-plus-circle"></i> Crear Cliente</button>
            </div>
        </div>
        <div class="col-md-7">
            <!-- Clients Table -->
            <div class="table-responsive">
                <table datatable [dtOptions]="dtOptions" class="table table-striped table-bordered table-condensed" style="width: 100%">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Direccion</th>
                            <th>Telefono</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let client of clients">
                            <td>{{ client.name }}</td>
                            <td>{{ client.address }}</td>
                            <td>{{ client.phoneNumber }}</td>
                            <td class="text-center">
                                <button class="btn btn-success text-center" (click)="choseClient(client.id)"><i class="fas fa-plus-circle"></i></button>                                
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>    
    <div class="row mt-md-2">
        <div class="col-md-5">
            <!-- Products Table -->                        
            <div class="table-responsive">
                <table datatable [dtOptions]="dtOptions" class="table table-striped table-bordered table-condensed" style="width: 100%">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let product of products">
                            <td>{{ product.name }}</td>
                            <td class="text-center">
                                <button class="btn btn-success text-center" (click)="addProduct(product)"><i class="fas fa-plus-circle"></i></button>                                
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-md-7">
            <!-- Shopping Cart -->
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-condensed" style="width: 100%">
                    <thead>
                        <tr>
                            <th class="col-1">Nombre</th>
                            <th class="col-1">Precio</th>
                            <th>Cantidad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody *ngIf="shoppingCart">
                        <tr *ngFor="let productInCart of shoppingCart; let i = index">
                            <td class="align-middle">{{ productInCart.product.name }}</td>
                            <td class="align-middle text-center">{{ productInCart.product.price | thousandsPipe }}</td>
                            <td>
                                <input type="number" class="form-control" [(ngModel)]="productInCart.amount" (keydown.enter)="actualizePrice()" (focusout)="actualizePrice()">
                            </td>
                            <td class="text-center">
                                <button class="btn btn-danger text-center" (click)="deleteProduct(i)"><i class="far fa-minus-square"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="d-block">
                <div>
                    <p class="h4 text-dark">Total: <span class="strong text-muted">{{ totalPrice | thousandsPipe }}</span></p>
                </div>
                <div>
                    <!-- Principal Actions -->                                
                    <button class="btn btn-info text-center mr-md-2 mb-md-0 mb-1 btn-sm-block" (click)="refreshPage()">Cancelar</button>
                    <button class="btn btn-success text-center btn-sm-block mr-0 mr-md-2 mb-1 mb-md-0" data-toggle="modal" data-target="#modal" (click)="finishOrder()" [disabled]="client.name.length <= 0 || shoppingCart.length == 0 ? true : null"><i class="far fa-file"></i> Terminar Pedido</button>
                    <div class="d-block d-md-inline-block">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">
                                    <input type="checkbox" [(ngModel)]="homeDelivery" (change)="priceOfHomeDeliveryChange()">
                                </div>
                            </div>
                            <input type="number" class="form-control col-10" [attr.placeholder]="!homeDelivery ? 'Domicilio' : 'Precio Del Domicilo'" [(ngModel)]="priceOfHomeDelivery" [attr.readonly]="!homeDelivery ? true : null" (input)="actualizePrice()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>    
    <div>
        <!-- Ticket Modal -->
        <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Pedido Finalizado</h5>
                    </div>
                    <div class="modal-body">
                        <!-- Ticket -->
                        <div class="m-2" id="ticket" #ticket>
                            <div *ngIf="company">
                                <img src="../../../assets/logo.png" class="rounded" style="width: 54px; height: 54px;" alt="Logo">
                                <h2 class="d-inline-block text-center">{{ company.name }}</h2>
                                <p class="text-center text-justify border border-dark p-2 my-2">{{ company.ticketMessage }}</p>
                            </div>
                            <p>                                        
                                <strong>Nombre:</strong> {{ client.name }} |
                                <span *ngIf="homeDelivery">
                                    <span *ngIf="client.address">
                                        Direccion: {{ client.address }} |
                                    </span>
                                    <span *ngIf="client.phoneNumber">
                                        Telefono: {{ client.phoneNumber }}
                                    </span>
                                </span>
                                <span *ngIf="!homeDelivery">
                                    Pedido Local
                                </span>
                            </p>                                                                                    
                            <table class="table table-sm my-2">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>Precio</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let productInCart of shoppingCart">
                                        <td>{{ productInCart.product.name }}</td>
                                        <td>{{ productInCart.amount | thousandsPipe }}</td>
                                        <td>{{ productInCart.product.price | thousandsPipe }}</td>
                                    </tr>
                                </tbody>
                                <tfoot class="font-weight-bold">
                                    <tr *ngIf="homeDelivery">
                                        <td>Sub-Total</td>
                                        <td></td>
                                        <td>{{ totalPrice - priceOfHomeDelivery | thousandsPipe }}</td>
                                    </tr>
                                    <tr *ngIf="homeDelivery">
                                        <td>Domicilio</td>
                                        <td></td>
                                        <td>{{ priceOfHomeDelivery | thousandsPipe }}</td>
                                    </tr>
                                    <tr>
                                        <td>Total</td>
                                        <td></td>
                                        <td>{{ totalPrice | thousandsPipe }}</td>
                                    </tr>                                       
                                </tfoot>
                            </table>                                                                        
                        </div>
                    </div>
                    <div class="modal-footer">                                
                        <button class="btn btn-info text-center" (click)="refreshPage()" data-dismiss="modal">Salir</button>                                                                                        
                        <button class="btn btn-info text-center" (click)="printPDF()"><i class="fas fa-print"></i> Imprimir</button>                                                                                           
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="!products">
    <div class="d-flex justify-content-center">
        <div class="spinner-border text-primary" role="status" style="height: 5rem; width: 5rem;">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>
